(()=>{"use strict";class e{static SIZES={carrier:5,battleship:4,cruiser:3,submarine:3,destroyer:2};constructor(e){this.length=e,this.hitCount=0}hit(){this.hitCount++}isSunk(){return this.hitCount===this.length}}class t{static SIZE=10;constructor(){this.grid=new Array(t.SIZE).fill(null).map((()=>new Array(t.SIZE).fill(null))),this.placedShips=[]}#e(e,t){return this.grid[t][e]}#t(e,t,a){this.grid[t][e]=a}static#a(e,a){return e>=0&&e<t.SIZE&&a>=0&&a<t.SIZE}static#n(a,n,r,s,i){if(!t.#a(r,s))return!1;if((i?s:r)>t.SIZE-n)return!1;for(let o=-1;o<=n;o++)for(let n=-1;n<=1;n++){const l=r+(i?n:o),d=s+(i?o:n);if(t.#a(l,d)&&a[d][l]instanceof e)return!1}return!0}placeShip(a,[n,r],s){if(!t.#n(this.grid,a,n,r,s))return!1;const i=new e(a);for(let e=0;e<a;e++)s?this.#t(n,r+e,i):this.#t(n+e,r,i);return this.placedShips.push(i),!0}static#r(){return[Math.floor(Math.random()*t.SIZE),Math.floor(Math.random()*t.SIZE)]}placeShipsRandomly(){const a=Object.values(e.SIZES);let n=0;for(;n<a.length;){const e=1===Math.floor(2*Math.random());this.placeShip(a[n],t.#r(),e)&&n++}}receiveAttack([t,a]){const n=this.#e(t,a);return"hit"!==n&&"miss"!==n&&(n instanceof e?(n.hit(),this.#t(t,a,"hit")):this.#t(t,a,"miss"),!0)}receiveComputerAttack(){const e=this.#s();if(e.length>0){const t=Math.floor(Math.random()*e.length),a=e.splice(t,1);return this.receiveAttack(...a)}const a=Math.random()<.05&&this.#i();if(a)return this.receiveAttack(a);let n=!1;for(;!n;)n=this.receiveAttack(t.#r());return!0}#i(){for(let a=0;a<t.SIZE;a++)for(let n=0;n<t.SIZE;n++){const t=this.#e(a,n);if(t instanceof e&&0===t.hitCount)return[a,n]}return null}#o(){const a=[];for(let n=0;n<t.SIZE;n++)for(let r=0;r<t.SIZE;r++){const t=this.#e(n,r);t instanceof e&&t.hitCount>0&&a.push([n,r])}return a}#s(){const a=[];for(let n=0;n<t.SIZE;n++)for(let r=0;r<t.SIZE;r++)if("hit"===this.#e(n,r)){const s=[[n+1,r],[n,r+1],[n-1,r],[n,r-1]];s.some((([a,n])=>t.#a(a,n)&&this.#e(a,n)instanceof e))&&s.forEach((([e,n])=>{if(t.#a(e,n)){const t=this.#e(e,n);"hit"!==t&&"miss"!==t&&a.push([e,n])}}))}return a}allShipsSunk(){return this.placedShips.every((e=>e.isSunk()))}}class a{constructor(e){this.name=e,this.gameboard=new t}resetBoard(){this.gameboard=new t}}const n=new class{constructor(){this.p1=new a("player"),this.p2=new a("computer"),this.p2.gameboard.placeShipsRandomly()}placePlayerShip(e,t,a,n){return this.p1.gameboard.placeShip(e,[t,a],n)}placePlayerShipsRandomly(){this.p1.resetBoard(),this.p1.gameboard.placeShipsRandomly()}areShipsPlaced(){return 5===this.p1.gameboard.placedShips.length}isGameOver(){return this.p1.gameboard.allShipsSunk()||this.p2.gameboard.allShipsSunk()}getWinner(){return this.p2.gameboard.allShipsSunk()?"player":"computer"}playerTurn(e,t){return this.p2.gameboard.receiveAttack([e,t])}computerTurn(){return this.p1.gameboard.receiveComputerAttack()}reset(){this.p1.resetBoard(),this.p2.resetBoard(),this.p2.gameboard.placeShipsRandomly()}},r=document.querySelector(".js-random-button"),s=document.querySelector(".js-restart-button"),i=document.querySelector(".js-rotate-button"),o=document.querySelector(".js-start-button"),l=document.getElementById("js-gameboard-container-p1"),d=document.getElementById("js-gameboard-container-p2"),c=document.querySelector(".js-dialog"),h=c.querySelector(".js-dialog__heading"),u=document.querySelector(".js-ship-placement");function p(){n.reset(),m(),g(),S()}function m(){const e=document.getElementById("js-ship-container");u.classList.toggle("ship-placement--hidden"),d.classList.toggle("gameboard-container--hidden"),e?.remove()}function g(){const t=document.createElement("div");t.classList="ship-container",t.id="js-ship-container";const a=Object.entries(e.SIZES);for(let e=0;e<a.length;e++){const[r,s]=a[e],i=document.createElement("div");i.classList=`ship ship--${r} js-ship`,i.id=`js-ship-${r}`,i.dataset.index=0,i.dataset.length=s,i.dataset.orientation="vertical",i.setAttribute("draggable",!0),(n=i).addEventListener("mousedown",(e=>function(e){const t=e.parentNode;t&&(t.dataset.index=e.dataset.index)}(e.target))),n.addEventListener("dragstart",(e=>function(e){e.dataTransfer.setData("text",e.target.id)}(e)));for(let e=0;e<s;e++){const t=document.createElement("div");t.classList="ship__cell",t.dataset.index=e,i.appendChild(t)}t.appendChild(i)}var n;u.appendChild(t)}function S(){!function(){const e=document.getElementById("js-gameboard-p1"),t=document.getElementById("js-gameboard-p2");e?.remove(),t?.remove()}(),l.appendChild(f(n.p1,1)),d.appendChild(f(n.p2,2)),function(){const e=document.querySelectorAll("#js-gameboard-p2 > .js-gameboard__cell"),t=document.querySelectorAll("#js-gameboard-p1 > .js-gameboard__cell");e.forEach((e=>e.addEventListener("click",(e=>{return t=e.target,void(n.playerTurn(t.dataset.x,t.dataset.y)&&(n.computerTurn(),S(),n.isGameOver()&&("player"===n.getWinner()?(h.classList.add("dialog__heading--win"),h.textContent="You won the game!"):(h.classList.remove("dialog__heading--win"),h.textContent="You lost the game..."),c.showModal(),s.blur())));var t})))),t.forEach((e=>{e.addEventListener("dragover",(e=>e.preventDefault())),e.addEventListener("drop",(e=>function(e){const t=e.dataTransfer.getData("text"),a=document.getElementById(t),r=Number(a.dataset.length),s="vertical"===a.dataset.orientation,i=Number(a.dataset.index),o=Number(e.target.dataset.x)-(s?0:i),l=Number(e.target.dataset.y)-(s?i:0);n.placePlayerShip(r,o,l,s)&&(a.parentElement.removeChild(a),S())}(e)))}))}()}function f(e,a){const n=document.createElement("div");n.classList=`gameboard gameboard--p${a}`,n.id=`js-gameboard-p${a}`;for(let a=0;a<t.SIZE;a++)for(let r=0;r<t.SIZE;r++){const t=document.createElement("div");t.classList="gameboard__cell js-gameboard__cell",t.dataset.x=r,t.dataset.y=a;const s=e.gameboard.grid[a][r];s&&("hit"===s||"miss"===s?t.classList.add(`gameboard__cell--${s}`):"player"===e.name&&t.classList.add("gameboard__cell--ship")),n.append(t)}return n}c.addEventListener("cancel",p),r.addEventListener("click",(function(){document.getElementById("js-ship-container").innerHTML="",n.placePlayerShipsRandomly(),S()})),s.addEventListener("click",(function(){c.close(),p()})),i.addEventListener("click",(function(){const e=document.getElementById("js-ship-container"),t=e.querySelectorAll(".js-ship");e.classList.toggle("ship-container--horizontal"),t.forEach((e=>{e.classList.toggle("ship--horizontal");const{orientation:t}=e.dataset;e.dataset.orientation="vertical"===t?"horizontal":"vertical"}))})),o.addEventListener("click",(function(){n.areShipsPlaced()?m():alert("You must finish placing your ships first.")})),g(),S()})();