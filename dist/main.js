(()=>{"use strict";class e{static SIZES={carrier:5,battleship:4,cruiser:3,submarine:3,destroyer:2};constructor(e){this.length=e,this.hitCount=0}hit(){this.hitCount++}isSunk(){return this.hitCount===this.length}}class t{static SIZE=10;constructor(){this.grid=new Array(t.SIZE).fill(null).map((()=>new Array(t.SIZE).fill(null))),this.placedShips=[]}#e(e,t){return this.grid[t][e]}#t(e,t,a){this.grid[t][e]=a}static#a(e,a){return e>=0&&e<t.SIZE&&a>=0&&a<t.SIZE}static#n(a,n,r,i,s){if(!t.#a(r,i))return!1;if((s?i:r)>t.SIZE-n)return!1;for(let o=-1;o<=n;o++)for(let n=-1;n<=1;n++){const l=r+(s?n:o),d=i+(s?o:n);if(t.#a(l,d)&&a[d][l]instanceof e)return!1}return!0}placeShip(a,[n,r],i){if(!t.#n(this.grid,a,n,r,i))return!1;const s=new e(a);for(let e=0;e<a;e++)i?this.#t(n,r+e,s):this.#t(n+e,r,s);return this.placedShips.push(s),!0}static#r(){return[Math.floor(Math.random()*t.SIZE),Math.floor(Math.random()*t.SIZE)]}placeShipsRandomly(){const a=Object.values(e.SIZES);let n=0;for(;n<a.length;){const e=1===Math.floor(2*Math.random());this.placeShip(a[n],t.#r(),e)&&n++}}receiveAttack([t,a]){const n=this.#e(t,a);return"hit"!==n&&"miss"!==n&&(n instanceof e?(n.hit(),this.#t(t,a,"hit")):this.#t(t,a,"miss"),!0)}receiveComputerAttack(){const e=this.#i();if(e)return this.receiveAttack(e);const a=this.#s();if(a.length>0){const e=Math.floor(Math.random()*a.length),t=a.splice(e,1);return this.receiveAttack(...t)}const n=Math.random()<.025&&this.#o();if(n)return this.receiveAttack(n);let r=!1;for(;!r;)r=this.receiveAttack(t.#r());return!0}#o(){for(let a=0;a<t.SIZE;a++)for(let n=0;n<t.SIZE;n++){const t=this.#e(a,n);if(t instanceof e&&0===t.hitCount)return[a,n]}return null}#i(){for(let a=0;a<t.SIZE;a++)for(let n=0;n<t.SIZE;n++){const t=this.#e(a,n);if(t instanceof e&&t.hitCount>1)return[a,n]}return null}#s(){const a=[];for(let n=0;n<t.SIZE;n++)for(let r=0;r<t.SIZE;r++)if("hit"===this.#e(n,r)){const i=[[n+1,r],[n,r+1],[n-1,r],[n,r-1]];i.some((([a,n])=>t.#a(a,n)&&this.#e(a,n)instanceof e))&&i.forEach((([e,n])=>{if(t.#a(e,n)){const t=this.#e(e,n);"hit"!==t&&"miss"!==t&&a.push([e,n])}}))}return a}allShipsSunk(){return this.placedShips.every((e=>e.isSunk()))}}class a{constructor(e){this.name=e,this.gameboard=new t}resetBoard(){this.gameboard=new t}}const n=new class{constructor(){this.p1=new a("player"),this.p2=new a("computer"),this.p2.gameboard.placeShipsRandomly()}placePlayerShip(e,t,a,n){return this.p1.gameboard.placeShip(e,[t,a],n)}placePlayerShipsRandomly(){this.p1.resetBoard(),this.p1.gameboard.placeShipsRandomly()}areShipsPlaced(){return 5===this.p1.gameboard.placedShips.length}isGameOver(){return this.p1.gameboard.allShipsSunk()||this.p2.gameboard.allShipsSunk()}getWinner(){return this.p2.gameboard.allShipsSunk()?"player":"computer"}playerTurn(e,t){return this.p2.gameboard.receiveAttack([e,t])}computerTurn(){return this.p1.gameboard.receiveComputerAttack()}reset(){this.p1.resetBoard(),this.p2.resetBoard(),this.p2.gameboard.placeShipsRandomly()}},r=document.querySelector(".js-random-button"),i=document.querySelector(".js-restart-button"),s=document.querySelector(".js-rotate-button"),o=document.querySelector(".js-start-button"),l=document.getElementById("js-gameboard-container-p1"),d=document.getElementById("js-gameboard-container-p2"),c=document.querySelector(".js-dialog"),h=c.querySelector(".js-dialog__heading"),u=document.querySelector(".js-ship-placement");function p(){n.reset(),m(),g(),S()}function m(){const e=document.getElementById("js-ship-container");u.classList.toggle("ship-placement--hidden"),d.classList.toggle("gameboard-container--hidden"),e?.remove()}function g(){const t=document.createElement("div");t.classList="ship-container",t.id="js-ship-container";const a=Object.entries(e.SIZES);for(let e=0;e<a.length;e++){const[r,i]=a[e],s=document.createElement("div");s.classList=`ship ship--${r} js-ship`,s.id=`js-ship-${r}`,s.dataset.index=0,s.dataset.length=i,s.dataset.orientation="vertical",s.setAttribute("draggable",!0),(n=s).addEventListener("mousedown",(e=>function(e){const t=e.parentNode;t&&(t.dataset.index=e.dataset.index)}(e.target))),n.addEventListener("dragstart",(e=>function(e){e.dataTransfer.setData("text",e.target.id)}(e)));for(let e=0;e<i;e++){const t=document.createElement("div");t.classList="ship__cell",t.dataset.index=e,s.appendChild(t)}t.appendChild(s)}var n;u.appendChild(t)}function S(){!function(){const e=document.getElementById("js-gameboard-p1"),t=document.getElementById("js-gameboard-p2");e?.remove(),t?.remove()}(),l.appendChild(f(n.p1,1)),d.appendChild(f(n.p2,2)),function(){const e=document.querySelectorAll("#js-gameboard-p2 > .js-gameboard__cell"),t=document.querySelectorAll("#js-gameboard-p1 > .js-gameboard__cell");e.forEach((e=>e.addEventListener("click",(e=>{return t=e.target,void(n.playerTurn(t.dataset.x,t.dataset.y)&&(n.computerTurn(),S(),n.isGameOver()&&("player"===n.getWinner()?(h.classList.add("dialog__heading--win"),h.textContent="You won the game!"):(h.classList.remove("dialog__heading--win"),h.textContent="You lost the game..."),c.showModal(),i.blur())));var t})))),t.forEach((e=>{e.addEventListener("dragover",(e=>e.preventDefault())),e.addEventListener("drop",(e=>function(e){const t=e.dataTransfer.getData("text"),a=document.getElementById(t),r=Number(a.dataset.length),i="vertical"===a.dataset.orientation,s=Number(a.dataset.index),o=Number(e.target.dataset.x)-(i?0:s),l=Number(e.target.dataset.y)-(i?s:0);n.placePlayerShip(r,o,l,i)&&(a.parentElement.removeChild(a),S()),e.preventDefault()}(e)))}))}()}function f(e,a){const n=document.createElement("div");n.classList=`gameboard gameboard--p${a}`,n.id=`js-gameboard-p${a}`;for(let a=0;a<t.SIZE;a++)for(let r=0;r<t.SIZE;r++){const t=document.createElement("div");t.classList="gameboard__cell js-gameboard__cell",t.dataset.x=r,t.dataset.y=a;const i=e.gameboard.grid[a][r];i&&("hit"===i||"miss"===i?t.classList.add(`gameboard__cell--${i}`):"player"===e.name&&t.classList.add("gameboard__cell--ship")),n.append(t)}return n}c.addEventListener("cancel",p),r.addEventListener("click",(function(){document.getElementById("js-ship-container").innerHTML="",n.placePlayerShipsRandomly(),S()})),i.addEventListener("click",(function(){c.close(),p()})),s.addEventListener("click",(function(){const e=document.getElementById("js-ship-container"),t=e.querySelectorAll(".js-ship");e.classList.toggle("ship-container--horizontal"),t.forEach((e=>{e.classList.toggle("ship--horizontal");const{orientation:t}=e.dataset;e.dataset.orientation="vertical"===t?"horizontal":"vertical"}))})),o.addEventListener("click",(function(){n.areShipsPlaced()?m():alert("You must finish placing your ships first.")})),g(),S()})();