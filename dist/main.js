(()=>{"use strict";class e{static SIZES={carrier:5,battleship:4,cruiser:3,submarine:3,destroyer:2};constructor(e){this.length=e,this.hitCount=0}hit(){this.hitCount++}isSunk(){return this.hitCount===this.length}}class t{static SIZE=10;constructor(){this.grid=new Array(t.SIZE).fill(null).map((()=>new Array(t.SIZE).fill(null))),this.placedShips=[]}static#e(e,a){return e>=0&&e<t.SIZE&&a>=0&&a<t.SIZE}static#t(a,r,s,n,i){if(!t.#e(s,n))return!1;if((i?n:s)>t.SIZE-r)return!1;for(let o=-1;o<=r;o++)for(let r=-1;r<=1;r++){const d=s+(i?r:o),c=n+(i?o:r);if(t.#e(d,c)&&a[c][d]instanceof e)return!1}return!0}placeShip(a,[r,s],n){if(!t.#t(this.grid,a,r,s,n))return!1;const i=new e(a);for(let e=0;e<a;e++)n?this.grid[s+e][r]=i:this.grid[s][r+e]=i;return this.placedShips.push(i),!0}static#a(){return[Math.floor(Math.random()*t.SIZE),Math.floor(Math.random()*t.SIZE)]}placeShipsRandomly(){const a=Object.values(e.SIZES);let r=0;for(;r<a.length;){const e=1===Math.floor(2*Math.random());this.placeShip(a[r],t.#a(),e)&&r++}}receiveAttack([t,a]){const r=this.grid[a][t];return"hit"!==r&&"miss"!==r&&(r instanceof e?(r.hit(),this.grid[a][t]="hit"):this.grid[a][t]="miss",!0)}receiveRandomAttack(){let e=!1;for(;!e;)e=this.receiveAttack(t.#a());return!0}allShipsSunk(){return this.placedShips.every((e=>e.isSunk()))}}class a{constructor(e){this.name=e,this.gameboard=new t}resetBoard(){this.gameboard=new t}}class r{static initialise(e){r.#r(e),r.#s(),r.#n(e)}static#i(e){e.reset(),r.#o(),r.#s(),r.#n(e)}static#d(e){document.querySelector(".js-dialog").close(),r.#i(e)}static#c(){const e=document.getElementById("js-ship-container"),t=e.querySelectorAll(".js-ship");e.classList.toggle("ship-container--horizontal"),t.forEach((e=>{e.classList.toggle("ship--horizontal");const{orientation:t}=e.dataset;e.dataset.orientation="vertical"===t?"horizontal":"vertical"}))}static#l(e){document.getElementById("js-ship-container").innerHTML="",e.p1.resetBoard(),e.p1.gameboard.placeShipsRandomly(),r.#n(e)}static#o(){const e=document.getElementById("js-gameboard-container-p2"),t=document.querySelector(".js-ship-placement"),a=document.getElementById("js-ship-container");t.classList.toggle("ship-placement--hidden"),e.classList.toggle("gameboard-container--hidden"),a?.remove()}static#r(e){const t=document.querySelector(".js-dialog"),a=document.querySelector(".js-random-button"),s=document.querySelector(".js-restart-button"),n=document.querySelector(".js-rotate-button"),i=document.querySelector(".js-start-button");t.addEventListener("cancel",(()=>r.#i(e))),a.addEventListener("click",(()=>r.#l(e))),s.addEventListener("click",(()=>r.#d(e))),n.addEventListener("click",r.#c),i.addEventListener("click",(()=>{e.areShipsPlaced()&&r.#o()}))}static#h(e){const t=e.parentNode;t&&(t.dataset.index=e.dataset.index)}static#m(e){e.dataTransfer.setData("text",e.target.id)}static#s(){const t=document.querySelector(".js-ship-placement"),a=document.createElement("div");a.classList="ship-container",a.id="js-ship-container";const s=Object.entries(e.SIZES);for(let e=0;e<s.length;e++){const[t,n]=s[e],i=document.createElement("div");i.classList=`ship ship--${t} js-ship`,i.id=`js-ship-${t}`,i.dataset.index=0,i.dataset.length=n,i.dataset.orientation="vertical",i.setAttribute("draggable",!0),i.addEventListener("mousedown",(e=>r.#h(e.target))),i.addEventListener("dragstart",(e=>r.#m(e)));for(let e=0;e<n;e++){const t=document.createElement("div");t.classList="ship__cell",t.dataset.index=e,i.appendChild(t)}a.appendChild(i)}t.appendChild(a)}static#p(e,t){const a=e.dataTransfer.getData("text"),s=document.getElementById(a),{length:n,index:i,orientation:o}=s.dataset,d="vertical"===o,c=Number(e.target.dataset.x)-(d?0:i),l=Number(e.target.dataset.y)-(d?i:0);t.p1.gameboard.placeShip(Number(n),[c,l],d)&&(s.parentElement.removeChild(s),r.#n(t))}static#g(e){const t=document.querySelector(".js-dialog"),a=t.querySelector(".js-dialog__heading"),r=t.querySelector(".js-restart-button");"player"===e.getWinner()?(a.classList.add("dialog__heading--win"),a.textContent="You won the game!"):(a.classList.remove("dialog__heading--win"),a.textContent="You lost the game..."),t.showModal(),r.blur()}static#u=(e,t)=>{t.playerTurn(e.dataset.x,e.dataset.y)&&(t.computerTurn(),r.#n(t),t.isGameOver()&&r.#g(t))};static#S(e){document.getElementById("js-gameboard-p1").querySelectorAll(".js-gameboard__cell").forEach((t=>{t.addEventListener("dragover",(e=>e.preventDefault())),t.addEventListener("drop",(t=>r.#p(t,e)))})),document.getElementById("js-gameboard-p2").querySelectorAll(".js-gameboard__cell").forEach((t=>t.addEventListener("click",(t=>r.#u(t.target,e)))))}static#b(){const e=document.getElementById("js-gameboard-p1"),t=document.getElementById("js-gameboard-p2");e?.remove(),t?.remove()}static#E(e,a){const r=document.createElement("div");r.classList=`gameboard gameboard--p${a}`,r.id=`js-gameboard-p${a}`;for(let a=0;a<t.SIZE;a++)for(let s=0;s<t.SIZE;s++){const t=document.createElement("div");t.classList="gameboard__cell js-gameboard__cell",t.dataset.x=s,t.dataset.y=a;const n=e.gameboard.grid[a][s];n&&("hit"===n||"miss"===n?t.classList.add(`gameboard__cell--${n}`):"player"===e.name&&t.classList.add("gameboard__cell--ship")),r.append(t)}return r}static#n(e){const t=document.getElementById("js-gameboard-container-p1"),a=document.getElementById("js-gameboard-container-p2");r.#b(),t.appendChild(r.#E(e.p1,1)),a.appendChild(r.#E(e.p2,2)),r.#S(e)}}r.initialise(new class{constructor(){this.p1=new a("player"),this.p2=new a("computer"),this.p2.gameboard.placeShipsRandomly()}areShipsPlaced(){return 5===this.p1.gameboard.placedShips.length}isGameOver(){return this.p1.gameboard.allShipsSunk()||this.p2.gameboard.allShipsSunk()}getWinner(){return this.p2.gameboard.allShipsSunk()?"player":"computer"}playerTurn(e,t){return this.p2.gameboard.receiveAttack([e,t])}computerTurn(){return this.p1.gameboard.receiveRandomAttack()}reset(){this.p1.resetBoard(),this.p2.resetBoard(),this.p2.gameboard.placeShipsRandomly()}})})();